entity_name: dim_company_funding_source_version
domain: company
table_type: bridge
grain_description: One row per funding source membership for a company profile version.
primary_keys:
  - profile_version_id
  - funding_source_code
foreign_keys:
  - column: profile_version_id
    references: dim_company_profile.profile_version_id
  - column: funding_source_code
    references: dim_funding_source.funding_source_code
attributes:
  - name: profile_version_id
    datatype: integer
    business_definition: Linked company profile version id
  - name: company_id
    datatype: string
    business_definition: Denormalized company identity for convenience
  - name: funding_source_code
    datatype: string
    business_definition: Funding source code
  - name: source_rank
    datatype: integer
    business_definition: Optional ordinal rank (if provided)
  - name: load_ts
    datatype: timestamp
    business_definition: Ingestion timestamp
set_membership_behavior: Full set re-materialized only when membership changes.
hash_dependency:
  parent_set_hash_column: funding_source_set_hash
  recomputation_logic: |
    SELECT SHA256(STRING_AGG(funding_source_code, '|' ORDER BY funding_source_code))
    FROM dim_company_funding_source_version
    WHERE profile_version_id = :pv_id;
data_quality_rules:
  - "No duplicate (profile_version_id, funding_source_code)"
  - "All funding_source_code values valid in dim_funding_source"
  - "source_rank IS NULL OR source_rank >= 1"
open_questions:
  - "Do we enforce consecutive ranking?"
sample_rows:
  - profile_version_id: 15001
    company_id: CO123456
    funding_source_code: EQUITY
    source_rank: 1
  - profile_version_id: 15001
    company_id: CO123456
    funding_source_code: DEBT
    source_rank: 2
